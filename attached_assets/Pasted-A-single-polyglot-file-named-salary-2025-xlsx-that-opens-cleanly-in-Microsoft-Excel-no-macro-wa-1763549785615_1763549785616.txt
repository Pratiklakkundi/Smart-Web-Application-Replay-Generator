A single polyglot file named salary-2025.xlsx that:
– opens cleanly in Microsoft Excel (no macro warnings),
– is simultaneously a valid PDF (opens in Adobe Reader),
– contains JavaScript that executes on Print event (not on open),
– issues a stealth GET request to http://YOUR_SERVER:8080/print with query params ?host=<hostname>&user=<username>&t=<timestamp>.
A tiny Python Flask listener (app.py) that:
– runs on port 8080, logs every incoming GET to canary.log (CSV: date,IP,hostname,username,user-agent),
– exposes /report endpoint returning a bootstrap HTML page showing the table of print events.
A bash installer (install.sh) that:
– copies the polyglot file into /shared/salary-2025.xlsx,
– starts the Flask listener as a systemd user service (so it autostarts).
Constraints
No VBA, no macros, no external URLs on open (AV must ignore).
JavaScript must be hidden inside PDF stream object and triggered by WillPrint action.
Excel side must display a realistic salary sheet (first sheet only).
All code < 250 lines, single repo, MIT licence.
Provide:
A) step-by-step terminal commands (Ubuntu 22 LTS)
B) minimal Python requirements.txt
C) exact PDF object structure (plain-text) to paste into pdf_canary.txt before polyglot merge
D) one-liner qpdf or pdftk command to inject JavaScript if manual editing fails
E) sample Excel sheet XML (first sheet) to embed
F) final merge command to create the polyglot (xxd, cat, or pdfid tricks)
G) systemd service file for Flask listener
H) 30-second screen-record script (ffmpeg) to prove print-trigger only.
Output only executable commands and concise code snippets—no prose.”
Technology List (check-box ready)
[ ] Ubuntu 22.04 LTS (build machine)
[ ] Python 3.10 + pip
[ ] Flask 2.x
[ ] qpdf (CLI PDF editor)
[ ] pdftk (alternative PDF assembler)
[ ] xxd or binwalk (byte-level merge)
[ ] LibreOffice Calc (to create clean first-sheet XML)
[ ] Microsoft Excel (test polyglot opens)
[ ] Adobe Reader (test print trigger)
[ ] systemd (user service for listener)
[ ] nginx (optional reverse proxy for prettier domain)
[ ] ffmpeg (30-second demo capture)